{% extends "layout.html" %}

{% block main %}
<div class="container-fluid py-4 px-md-5">
    <div class="card shadow-sm border-0 rounded-4 overflow-hidden bg-body">
        <div class="card-body p-0"> 
            <div id="calendar"></div>
        </div>
    </div>
</div>

<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    
    var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        height: 'auto',
        // This ensures the calendar fetches data every time the view changes
        events: {
            url: '/api/assignments',
            failure: function() {
                alert('There was an error fetching assignments!');
            }
        },
        // Force the text to be visible
        eventTextColor: '#ffffff',
        eventColor: '#0d6efd',
        
        // Debugging: This will print the data to your browser's "Inspect" console
        eventSourceSuccess: function(content, xhr) {
            console.log("Successfully loaded assignments:", content);
            return content;
        },
        
        // Ensure it handles the "allDay" logic regardless of server settings
        eventDataTransform: function(eventData) {
            eventData.allDay = true; 
            return eventData;
        }
    });
    
    calendar.render();
});
</script>

<style>
    /* 1. Remove hardcoded white background so it follows Dark Mode */
    #calendar {
        padding: 20px;
        background: transparent; 
        color: inherit;
    }

    /* 2. Fix Header Title to adapt to dark/light text */
    .fc-toolbar-title {
        font-size: 1.5rem !important;
        font-weight: 700;
        /* Using Bootstrap variable for primary color */
        color: var(--bs-primary) !important; 
    }

    /* 3. Style Buttons */
    .fc-button-primary {
        background-color: #0d6efd !important;
        border: none !important;
        border-radius: 8px !important;
        padding: 8px 16px !important;
        text-transform: capitalize;
    }

    /* 4. Fix Grid Lines for Dark Mode */
    .fc td, .fc th {
        border-color: var(--bs-border-color) !important;
    }

    /* 5. Make the "Today" cell highlight better in dark mode */
    .fc-day-today {
        background-color: var(--bs-primary-bg-subtle) !important;
    }

    /* 6. Fix text color for days in dark mode */
    .fc-col-header-cell-cushion, .fc-daygrid-day-number {
        color: var(--bs-body-color);
        text-decoration: none;
    }
</style>
{% endblock %}
